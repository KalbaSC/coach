<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>بوابة مدربي نادي كلباء</title>
  <style>
    @font-face {
      font-family: 'NotoKufiArabic';
      src: url('NotoKufiArabic.ttf') format('truetype');
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'NotoKufiArabic', sans-serif;
      background: url('black_and_yellow_grunge_background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    .header-container {
      background: #111;
      border-bottom: 2px solid #f4e733;
      text-align: center;
      padding: 15px;
    }
    .header-container img {
      height: 60px;
      margin: 0 10px;
    }
    .header-info .arabic-name {
      font-weight: bold;
      font-size: 20px;
    }
    .header-info .english-name {
      font-size: 14px;
      color: #f4e733;
    }
    input, select, button {
      margin: 5px;
      padding: 10px;
      border: 1px solid #f4e733;
      border-radius: 5px;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #f4e733;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #333;
    }
  </style>
</head>
<body>

<div class="header-container">
  <img src="Picture3.png" alt="شعار الشارقة">
  <img src="logo.png" alt="شعار نادي كلباء">
  <div class="header-info">
    <div class="arabic-name">نادي كلباء الرياضي الثقافي</div>
    <div class="english-name">KALBA SPORTS & CULTURAL CLUB</div>
  </div>
</div>

<h2>بوابة المدرب - تقييم اللاعبين</h2>
<input type="date" id="dateFilter">
<button onclick="loadPlayers()">عرض اللاعبين</button>
<div id="playersContainer"></div>

<script>
const attendanceURL = 'https://script.google.com/macros/s/AKfycbxij6xIH_fypPRhklqQKURq-7xB5RJ3sC5dCBfwj4sJBjqnfXde1ncFrhCpDy04zuZW6g/exec';
const evaluationURL = 'https://script.google.com/macros/s/AKfycbzpbUmXmD3ik-2Cgc64UZeWBL6hLSc_LDDwg0YoSCR_4bOKy4YUj8PrVczBfTi-Rj6a/exec';
const currentCoach = 'مدرب الشطرنج'; // استبدله حسب تسجيل الدخول
const coachActivity = 'شطرنج';

async function loadPlayers() {
  const selectedDate = document.getElementById('dateFilter').value;
  if (!selectedDate) return alert('يرجى اختيار تاريخ');

  const response = await fetch(attendanceURL);
  const data = await response.json();
  const players = data.filter(p => p.Activity === coachActivity && p.Timestamp.startsWith(selectedDate));

  let html = `<h3>اللاعبين في ${coachActivity} بتاريخ ${selectedDate}</h3>
    <table>
    <tr><th>اسم اللاعب</th><th>المعرف</th><th>التقييم</th></tr>`;

  players.forEach(player => {
    html += `<tr>
      <td>${player['Child Name']} ${player.Parent || ''}</td>
      <td>${player.ID}</td>
      <td>
        <select onchange="submitEvaluation('${player.ID}', this.value)">
          <option value="">اختر التقييم</option>
          <option value="ممتاز">ممتاز</option>
          <option value="جيد جداً">جيد جداً</option>
          <option value="جيد">جيد</option>
          <option value="مقبول">مقبول</option>
          <option value="ضعيف">ضعيف</option>
        </select>
      </td>
    </tr>`;
  });
  html += '</table>';
  document.getElementById('playersContainer').innerHTML = html;
}

function submitEvaluation(playerId, evaluation) {
  if (!evaluation) return;
  const payload = {
    coach: currentCoach,
    activity: coachActivity,
    playerId: playerId,
    evaluation: evaluation
  };

  fetch(evaluationURL, {
    method: 'POST',
    body: JSON.stringify(payload),
    headers: { 'Content-Type': 'application/json' }
  })
  .then(res => res.text())
  .then(() => alert(`تم تقييم اللاعب ${playerId} بـ ${evaluation}`))
  .catch(() => alert('فشل إرسال التقييم'));
}
</script>

</body>
</html>
